//copy to get exact length of data?
//var data = new Buffer(data);
//NOW fileDataTo... NEED TO GET AN UNMODIFIED BUFFER WITH FILE CONTENTS

//api somewhat similiar to node.js's fs
var fs = require('fs');
var utils = require('utils');

/**
 * Create blob buffer from buffer containing file
 * @param data Unmodyfied buffer with file data
 * @return uncompressed blob
 */
var fileToBlob = function(data, callback)
{
    var header = 'blob '+data.length+'\0';
    var head = new Buffer(header);
    var store = Buffer.concat([head, data]);
    return store;
}

/**
 * Reads file and saves it in repo as blob using optional options.
 * @param filePath path to file
 * @param repoPath path to .git folder f.e. /my_project/.git/
 * @param options optional zlib compression options
 */
var saveFileAsBlob = function(filePath, repoPath, options)
{
    options = options || {};
    fs.readFile(filePath, function (err, data) {
        if(err) callback(err);
        saveFileDataAsBlob(data, repoPath, options);
    });
}

/**
 * Produce buffer with file contents from given uncompressed blob buffer
 * @param data
 * @return buffer with file 
 */
var blobToFile = function(data)
{
    var i = 0;
    while(data[i] != 0)
    {
        i++;
    }
    var fileBuffer = data.slice(i+1);
    return fileBuffer; 
}


exports.blobToFile = blobToFile;
exports.fileToBlob = fileToBlob;

